package com.exploitpack.main;

import java.io.BufferedReader;
import java.io.BufferedWriter;
import java.io.FileReader;
import java.io.FileWriter;

import org.eclipse.swt.graphics.Rectangle;
import org.eclipse.swt.widgets.Display;
import org.eclipse.swt.widgets.Shell;
import org.eclipse.wb.swt.SWTResourceManager;
import org.eclipse.swt.widgets.Label;
import org.eclipse.swt.SWT;
import org.eclipse.swt.widgets.MessageBox;
import org.eclipse.swt.widgets.Text;
import org.eclipse.swt.widgets.Button;
import org.eclipse.swt.widgets.Link;
import org.eclipse.swt.events.SelectionAdapter;
import org.eclipse.swt.events.SelectionEvent;
import org.eclipse.swt.events.MouseAdapter;
import org.eclipse.swt.events.MouseEvent;

public class Register {

	protected Shell shlExploitPack;
	private Text txtSerial;
	private boolean SerialOK;
	public String[] Serial = { "6692-2664-8354-0021", "7824-2664-2435-3341",
			"8642-6664-2675-8881", "8312-2364-2935-3441",
			"4342-1234-7543-1121", "9872-2324-8745-3661",
			"8387-6843-3232-0002", "9082-6822-3232-0232",
			"9231-6843-5722-9840", "6904-8372-9987-0007" };

	public static void main(String[] args) {
		try {
			Register window = new Register();
			window.open();
		} catch (Exception e) {
			e.printStackTrace();
		}
	}

	public void open() {
		Display display = Display.getDefault();
		createContents();

		Rectangle bounds = display.getBounds();
		Rectangle rect = shlExploitPack.getBounds();

		int x = bounds.x + (bounds.width - rect.width) / 2;
		int y = bounds.y + (bounds.height - rect.height) / 2;

		shlExploitPack.setLocation(x, y);
		shlExploitPack.open();
		shlExploitPack.layout();
		while (!shlExploitPack.isDisposed()) {
			if (!display.readAndDispatch()) {
				display.sleep();
			}
		}
	}

	protected void createContents() {
		shlExploitPack = new Shell();
		shlExploitPack.setImage(SWTResourceManager.getImage(Register.class,
				"/resources/1316133906_package.png"));
		shlExploitPack.setSize(564, 180);
		shlExploitPack.setText("Exploit Pack - Register");

		Label lblThankYouFor = new Label(shlExploitPack, SWT.NONE);
		lblThankYouFor.setFont(SWTResourceManager
				.getFont("Tahoma", 8, SWT.BOLD));
		lblThankYouFor.setBounds(84, 10, 401, 13);
		lblThankYouFor
				.setText("Thank you for trying Exploit Pack");

		Label lblToAccessTo = new Label(shlExploitPack, SWT.NONE);
		lblToAccessTo.setBounds(84, 29, 462, 21);
		lblToAccessTo
				.setText("Please enter your serial number here to unlock all functionalities.");

		Label lblNewLabel = new Label(shlExploitPack, SWT.NONE);
		lblNewLabel.setBounds(84, 48, 422, 25);
		lblNewLabel
				.setText("We recommend you to copy your serial number to the clipboard:");

		txtSerial = new Text(shlExploitPack, SWT.BORDER);
		txtSerial.setText("PASTE YOUR SERIAL HERE..");
		txtSerial.addMouseListener(new MouseAdapter() {
			@Override
			public void mouseDown(MouseEvent e) {
				if (txtSerial.getText().contains("PASTE YOUR SERIAL HERE..")) {
					txtSerial.setText("");
				}

			}
		});

		txtSerial.setBounds(84, 79, 327, 27);

		Button btnRegister = new Button(shlExploitPack, SWT.NONE);
		btnRegister.addSelectionListener(new SelectionAdapter() {
			@Override
			public void widgetSelected(SelectionEvent e) {

				for (int j = 0; j < Serial.length; j++) {

					if (txtSerial.getText().equals(Serial[j])) {
						SerialOK = true;
						System.out.println("SI " + Serial[j]);
					}

					if (SerialOK == true) {
						MessageBox mb = new MessageBox(shlExploitPack,
								SWT.ICON_INFORMATION);
						mb.setText("Exploit Pack - Registration Done");
						mb.setMessage("Thank you for registering your license,\r\nYour version of Exploit Pack is now activated.");
						mb.open();
						MainWindow.shlExploitPack.setText("Exploit Pack - Security Framework");
						try {
							// Activate
							FileWriter fstream = new FileWriter(
									"data/config/exploitpack1");
							BufferedWriter out = new BufferedWriter(fstream);
							out.append("1");
							// Close the output stream
							out.close();
						} catch (Exception e1) {
							System.err.println("Error: " + e1.getMessage());
						}
						SerialOK = false;
						return;
					}
				}

				MessageBox mb = new MessageBox(shlExploitPack, SWT.ERROR);
				mb.setText("Exploit Pack - Invalid Serial");
				mb.setMessage("Sorry, you entered an invalid serial number,\r\nfor technical support please contact us.");
				mb.open();

			}

		});
		btnRegister.setBounds(417, 77, 133, 29);
		btnRegister.setText("Register my copy");

		Label lblNewLabel_1 = new Label(shlExploitPack, SWT.NONE);
		lblNewLabel_1.setBounds(10, 112, 244, 29);
		lblNewLabel_1
				.setText("Register your copy of Exploit Pack:");

		Link link = new Link(shlExploitPack, SWT.NONE);
		link.setBounds(244, 112, 188, 29);
		link.setText("<a>http://exploitpack.com</a>");

		Label lblNewLabel_2 = new Label(shlExploitPack, SWT.NONE);
		lblNewLabel_2.setImage(SWTResourceManager.getImage(Register.class,
				"/resources/1330157278_key.png"));
		lblNewLabel_2.setBounds(10, 10, 68, 77);

		Label lblNewLabel_3 = new Label(shlExploitPack, SWT.NONE);
		lblNewLabel_3.setBounds(417, 112, 152, 29);
		lblNewLabel_3.setText("BUILD: 20130905");

	}
}
